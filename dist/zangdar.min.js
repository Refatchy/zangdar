!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"$form",null),n(this,"_$prevButtons",null),n(this,"_steps",[]),n(this,"_currentIndex",null),n(this,"_params",{step_selector:"[data-step]",prev_step_selector:"[data-prev]",next_step_selector:"[data-next]",submit_selector:'[type="submit"]',active_step_index:0,classes:{form:"zandgar__wizard",prev_button:"zandgar__prev",next_button:"zandgar__next",step:"zandgar__step",step_active:"zandgar__step__active"},onSubmit:null,onStepChange:null,onValidation:null,customValidation:null}),this.$form=t instanceof HTMLFormElement?t:document.querySelector(t),this.$form.constructor!==HTMLFormElement)throw new Error("[Err] Zangdar.constructor - the container must be a valid HTML form element");this._params=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},s=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),s.forEach(function(t){n(e,t,r[t])})}return e}({},this._params,r),this._init()}var t,s,a;return t=e,(s=[{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._currentIndex;return this._steps[e]||null}},{key:"prev",value:function(){this._prevStep()}},{key:"next",value:function(){this._nextStep()}},{key:"revealStep",value:function(e){throw this._steps.findIndex(function(t){return t.label===e})>=0&&this._revealStep(),new Error('[Err] Zangdar.revealStep - step "'.concat(e,'" not found'))}},{key:"createFromTemplate",value:function(e){var t=this,r=0;for(var n in e)++r,e.hasOwnProperty(n)&&function(){var s=e[n],a=t._buildSection(n);if(s.forEach(function(e){var r=t.$form.querySelector(e);if(null!==r){var n=r.cloneNode(!0);a.appendChild(n),r.parentNode.removeChild(r)}}),r<Object.keys(e).length&&null===a.querySelector(t._params.next_step_selector)){var i=document.createElement("button");i.setAttribute(t._params.next_step_selector.replace(/\[|\]/gi,""),""),i.innerText="Next",a.appendChild(i)}if(r===Object.keys(e).length){var o=t.$form.querySelector(t._params.submit_selector);if(null!==o){var u=o.cloneNode(!0);a.appendChild(u),o.parentNode.removeChild(o)}}t.$form.appendChild(a)}();this._init()}},{key:"getCurrentStep",value:function(){return this.get()}},{key:"_init",value:function(){this.$form.querySelectorAll(this._params.step_selector).length&&(this._buildForm(),this._buildPrevButton(),this._buildSteps())}},{key:"_buildForm",value:function(){var e=this,t=this._params.onSubmit;this.$form.classList.add(this._params.classes.form),this.$form.addEventListener("submit",function(r){e._validateCurrentStep()&&(t&&t.constructor===Function?t(r):r.target.submit())})}},{key:"_buildPrevButton",value:function(){var e=this;if(this._$prevButtons=this.$form.querySelectorAll(this._params.prev_step_selector),this._$prevButtons&&this._$prevButtons.length)Array.from(this._$prevButtons).forEach(function(t){t.classList.add(e._params.classes.prev_button),t.addEventListener("click",function(t){t.preventDefault(),e._prevStep()})});else{var t=document.createElement("button");t.setAttribute("data-prev",""),t.innerText="Prev.",this.$form.insertBefore(t,this.$form.firstChild),this._buildPrevButton()}}},{key:"_buildSteps",value:function(){var e=this,t=Array.from(this.$form.querySelectorAll(this._params.step_selector));if(!t.length)throw new Error('[Err] Zangdar._buildSteps - you must have at least one step (a HTML element with "'.concat(this._params.step_selector,'" attribute)'));t.reduce(function(r,n,s){var a=n.dataset.step;if(n.classList.add(e._params.classes.step),s===e._params.active_step_index&&(n.classList.add(e._params.classes.step_active),e._currentIndex=s),s<t.length-1&&!n.querySelector(e._params.next_step_selector))throw new Error('[Err] Zangdar._buildSteps - step "'.concat(a,'" - you must have a next button (with "').concat(e._params.next_step_selector,'" attribute") on this step'));if(s<t.length-1&&n.querySelector(e._params.next_step_selector)){var i=n.querySelector(e._params.next_step_selector);i.classList.add(e._params.classes.next_button),i.addEventListener("click",function(t){t.preventDefault(),e._validateCurrentStep()&&e._nextStep()})}return r.push({el:n,label:a,active:!1,errors:{}}),r},this._steps),this._currentIndex=this._params.active_step_index,this._revealStep()}},{key:"_buildSection",value:function(e){var t=document.createElement("section");return t.setAttribute(this._params.step_selector.replace(/\[|\]/gi,""),e),t}},{key:"_revealStep",value:function(){var e=this;this._steps.forEach(function(t,r){t.active=e._currentIndex===r,t.active?t.el.classList.add(e._params.classes.step_active):t.el.classList.remove(e._params.classes.step_active)}),this._hidePrevBtns()}},{key:"_hidePrevBtns",value:function(){var e=this;this._$prevButtons&&this._$prevButtons.length?Array.from(this._$prevButtons).forEach(function(t){return t.style.display=0===e._currentIndex?"none":""}):this._buildPrevButton()}},{key:"_prevStep",value:function(){var e=this.getCurrentStep();this._currentIndex=this._currentIndex-1<0?0:this._currentIndex-1,this._params.onStepChange(this.getCurrentStep(),e,-1,this.$form),this._revealStep()}},{key:"_nextStep",value:function(){var e=this.getCurrentStep();this._currentIndex=this._currentIndex<this._steps.length-1?this._currentIndex+1:this._steps.length,this._params.onStepChange(this.getCurrentStep(),e,1,this.$form),this._revealStep()}},{key:"_validateCurrentStep",value:function(){var e=this._steps[this._currentIndex],t=this._formElements(e.el);if(this._params.customValidation&&this._params.customValidation.constructor===Function)return this.$form.setAttribute("novalidate",""),this._params.customValidation(e,t,this.$form);this.$form.removeAttribute("novalidate"),e.errors={};var r=!0;return Array.from(t).reverse().forEach(function(t){t.checkValidity()||(r=!1,e.errors[t.name]||(e.errors[t.name]=[]),e.errors[t.name].push(t.validationMessage),t.reportValidity())}),this._params.onValidation(e,t,this.$form),r}},{key:"_formElements",value:function(e){return e.querySelectorAll("            ".concat(this._params.step_selector,' input:not([type="hidden"]):not([disabled]),            ').concat(this._params.step_selector," select:not([disabled]),            ").concat(this._params.step_selector," textarea:not([disabled])        "))}}])&&r(t.prototype,s),a&&r(t,a),e}();void 0!==window?(!window.hasOwnProperty("Zangdar")&&(window.Zangdar=s),HTMLFormElement.prototype.zangdar||(HTMLFormElement.prototype.zangdar=function(e){return new s(this,e)})):e.exports=s}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiWmFuZ2RhciIsImVsZW1lbnQiLCJvcHRpb25zIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIl9kZWZpbmVQcm9wZXJ0eSIsInN0ZXBfc2VsZWN0b3IiLCJwcmV2X3N0ZXBfc2VsZWN0b3IiLCJuZXh0X3N0ZXBfc2VsZWN0b3IiLCJzdWJtaXRfc2VsZWN0b3IiLCJhY3RpdmVfc3RlcF9pbmRleCIsImNsYXNzZXMiLCJmb3JtIiwicHJldl9idXR0b24iLCJuZXh0X2J1dHRvbiIsInN0ZXAiLCJzdGVwX2FjdGl2ZSIsIm9uU3VibWl0Iiwib25TdGVwQ2hhbmdlIiwib25WYWxpZGF0aW9uIiwiY3VzdG9tVmFsaWRhdGlvbiIsIiRmb3JtIiwiSFRNTEZvcm1FbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29uc3RydWN0b3IiLCJFcnJvciIsIl9wYXJhbXMiLCJfb2JqZWN0U3ByZWFkIiwiX2luaXQiLCJpbmRleCIsIl9jdXJyZW50SW5kZXgiLCJfc3RlcHMiLCJfcHJldlN0ZXAiLCJfbmV4dFN0ZXAiLCJsYWJlbCIsImZpbmRJbmRleCIsIl9yZXZlYWxTdGVwIiwiY29uY2F0IiwidGVtcGxhdGUiLCJfdGhpcyIsImZpZWxkcyIsIiRzZWN0aW9uIiwiX2J1aWxkU2VjdGlvbiIsImZvckVhY2giLCJmaWVsZCIsImVsIiwibmV3RWxtIiwiY2xvbmVOb2RlIiwiYXBwZW5kQ2hpbGQiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJrZXlzIiwiJG5leHRCdXR0b24iLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwicmVwbGFjZSIsImlubmVyVGV4dCIsIiRzdWJtaXRCdXR0b24iLCJuZXdCdG4iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2J1aWxkRm9ybSIsIl9idWlsZFByZXZCdXR0b24iLCJfYnVpbGRTdGVwcyIsIl90aGlzMiIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiX3ZhbGlkYXRlQ3VycmVudFN0ZXAiLCJGdW5jdGlvbiIsInRhcmdldCIsInN1Ym1pdCIsIl90aGlzMyIsIl8kcHJldkJ1dHRvbnMiLCJBcnJheSIsImZyb20iLCJidG4iLCJwcmV2ZW50RGVmYXVsdCIsIiRwcmV2QnRuIiwiaW5zZXJ0QmVmb3JlIiwiZmlyc3RDaGlsZCIsIl90aGlzNCIsInN0ZXBzIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsImRhdGFzZXQiLCJwdXNoIiwiYWN0aXZlIiwiZXJyb3JzIiwiX3RoaXM1IiwicmVtb3ZlIiwiX2hpZGVQcmV2QnRucyIsIl90aGlzNiIsInN0eWxlIiwiZGlzcGxheSIsIm9sZFN0ZXAiLCJnZXRDdXJyZW50U3RlcCIsImN1cnJlbnRTdGVwIiwiX2Zvcm1FbGVtZW50cyIsInJlbW92ZUF0dHJpYnV0ZSIsImlzVmFsaWQiLCJyZXZlcnNlIiwiY2hlY2tWYWxpZGl0eSIsInZhbGlkYXRpb25NZXNzYWdlIiwicmVwb3J0VmFsaWRpdHkiLCJ3aW5kb3ciLCJ6YW5nZGFyIl0sIm1hcHBpbmdzIjoiYUFDQSxJQUFBQSxFQUFBLEdBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsR0FBQSxDQUNBRyxFQUFBSCxFQUNBSSxHQUFBLEVBQ0FILFFBQUEsSUFVQSxPQU5BSSxFQUFBTCxHQUFBTSxLQUFBSixFQUFBRCxRQUFBQyxJQUFBRCxRQUFBRixHQUdBRyxFQUFBRSxHQUFBLEVBR0FGLEVBQUFELFFBS0FGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFBc0IsRUFBQSxTQUFBRCxFQUFBRSxHQUVBLEdBREEsRUFBQUEsSUFBQUYsRUFBQXJCLEVBQUFxQixJQUNBLEVBQUFFLEVBQUEsT0FBQUYsRUFDQSxLQUFBRSxHQUFBLGlCQUFBRixRQUFBRyxXQUFBLE9BQUFILEVBQ0EsSUFBQUksRUFBQVgsT0FBQVksT0FBQSxNQUdBLEdBRkExQixFQUFBa0IsRUFBQU8sR0FDQVgsT0FBQUMsZUFBQVUsRUFBQSxXQUF5Q1QsWUFBQSxFQUFBSyxVQUN6QyxFQUFBRSxHQUFBLGlCQUFBRixFQUFBLFFBQUFNLEtBQUFOLEVBQUFyQixFQUFBVSxFQUFBZSxFQUFBRSxFQUFBLFNBQUFBLEdBQWdILE9BQUFOLEVBQUFNLElBQXFCQyxLQUFBLEtBQUFELElBQ3JJLE9BQUFGLEdBSUF6QixFQUFBNkIsRUFBQSxTQUFBMUIsR0FDQSxJQUFBUyxFQUFBVCxLQUFBcUIsV0FDQSxXQUEyQixPQUFBckIsRUFBQSxTQUMzQixXQUFpQyxPQUFBQSxHQUVqQyxPQURBSCxFQUFBVSxFQUFBRSxFQUFBLElBQUFBLEdBQ0FBLEdBSUFaLEVBQUFhLEVBQUEsU0FBQWlCLEVBQUFDLEdBQXNELE9BQUFqQixPQUFBa0IsVUFBQUMsZUFBQTFCLEtBQUF1QixFQUFBQyxJQUd0RC9CLEVBQUFrQyxFQUFBLEdBSUFsQyxJQUFBbUMsRUFBQSxxVkNsRk1DLGFBeURGLFNBQUFBLEVBQVlDLEdBQXVCLElBQWRDLEVBQWNDLFVBQUFDLE9BQUEsUUFBQUMsSUFBQUYsVUFBQSxHQUFBQSxVQUFBLEdBQUosR0FLM0IsK0ZBTCtCRyxDQUFBQyxLQUFBUCxHQUFBUSxFQUFBRCxLQUFBLFFBcEQzQixNQW9EMkJDLEVBQUFELEtBQUEsZ0JBN0NuQixNQTZDbUJDLEVBQUFELEtBQUEsU0F0QzFCLElBc0MwQkMsRUFBQUQsS0FBQSxnQkEvQm5CLE1BK0JtQkMsRUFBQUQsS0FBQSxVQXZCekIsQ0FDTkUsY0FBZSxjQUNmQyxtQkFBb0IsY0FDcEJDLG1CQUFvQixjQUNwQkMsZ0JBQWlCLGtCQUNqQkMsa0JBQW1CLEVBQ25CQyxRQUFTLENBQ0xDLEtBQU0sa0JBQ05DLFlBQWEsZ0JBQ2JDLFlBQWEsZ0JBQ2JDLEtBQU0sZ0JBQ05DLFlBQWEseUJBRWpCQyxTQUFVLEtBQ1ZDLGFBQWMsS0FDZEMsYUFBYyxLQUNkQyxpQkFBa0IsT0FRbEJoQixLQUFLaUIsTUFBUXZCLGFBQW1Cd0IsZ0JBQzFCeEIsRUFDQXlCLFNBQVNDLGNBQWMxQixHQUV6Qk0sS0FBS2lCLE1BQU1JLGNBQWdCSCxnQkFDM0IsTUFBTSxJQUFJSSxNQUFKLCtFQUVWdEIsS0FBS3VCLDBVQUFMQyxDQUFBLEdBQ094QixLQUFLdUIsUUFDTDVCLEdBR1BLLEtBQUt5Qiw2REFTdUIsSUFBNUJDLEVBQTRCOUIsVUFBQUMsT0FBQSxRQUFBQyxJQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBcEJJLEtBQUsyQixjQUNiLE9BQU8zQixLQUFLNEIsT0FBT0YsSUFBVSxvQ0FPN0IxQixLQUFLNkIsMkNBT0w3QixLQUFLOEIsK0NBUUVDLEdBS1AsTUFKYy9CLEtBQUs0QixPQUFPSSxVQUFVLFNBQUFyQixHQUFJLE9BQUlBLEVBQUtvQixRQUFVQSxLQUM5QyxHQUNUL0IsS0FBS2lDLGNBRUgsSUFBSVgsTUFBSixvQ0FBQVksT0FBOENILEVBQTlDLDJEQVFTSSxHQUFVLElBQUFDLEVBQUFwQyxLQUNyQnZDLEVBQUksRUFDUixJQUFLLElBQUlzRSxLQUFTSSxJQUNaMUUsRUFDRTBFLEVBQVM3QyxlQUFleUMsSUFBUSxXQUNoQyxJQUFNTSxFQUFTRixFQUFTSixHQUNsQk8sRUFBV0YsRUFBS0csY0FBY1IsR0FTcEMsR0FSQU0sRUFBT0csUUFBUSxTQUFBQyxHQUNYLElBQU1DLEVBQUtOLEVBQUtuQixNQUFNRyxjQUFjcUIsR0FDcEMsR0FBVyxPQUFQQyxFQUFhLENBQ2IsSUFBTUMsRUFBU0QsRUFBR0UsV0FBVSxHQUM1Qk4sRUFBU08sWUFBWUYsR0FDckJELEVBQUdJLFdBQVdDLFlBQVlMLE1BRzlCakYsRUFBSVUsT0FBTzZFLEtBQUtiLEdBQVV0QyxRQUFzRSxPQUE1RHlDLEVBQVNsQixjQUFjZ0IsRUFBS2IsUUFBUW5CLG9CQUE4QixDQUN0RyxJQUFNNkMsRUFBYzlCLFNBQVMrQixjQUFjLFVBQzNDRCxFQUFZRSxhQUFhZixFQUFLYixRQUFRbkIsbUJBQW1CZ0QsUUFBUSxVQUFXLElBQUssSUFDakZILEVBQVlJLFVBQVksT0FDeEJmLEVBQVNPLFlBQVlJLEdBRXpCLEdBQUl4RixJQUFNVSxPQUFPNkUsS0FBS2IsR0FBVXRDLE9BQVEsQ0FDcEMsSUFBTXlELEVBQWdCbEIsRUFBS25CLE1BQU1HLGNBQWNnQixFQUFLYixRQUFRbEIsaUJBQzVELEdBQXNCLE9BQWxCaUQsRUFBd0IsQ0FDeEIsSUFBTUMsRUFBU0QsRUFBY1YsV0FBVSxHQUN2Q04sRUFBU08sWUFBWVUsR0FDckJELEVBQWNSLFdBQVdDLFlBQVlPLElBRzdDbEIsRUFBS25CLE1BQU00QixZQUFZUCxHQXpCUyxHQTRCeEN0QyxLQUFLeUIsaURBU0wsT0FBT3pCLEtBQUsxQixzQ0FJUjBCLEtBQUtpQixNQUFNdUMsaUJBQWlCeEQsS0FBS3VCLFFBQVFyQixlQUFlTCxTQUN4REcsS0FBS3lELGFBQ0x6RCxLQUFLMEQsbUJBQ0wxRCxLQUFLMkQsb0RBSUEsSUFBQUMsRUFBQTVELEtBQ0hhLEVBQVdiLEtBQUt1QixRQUFRVixTQUM5QmIsS0FBS2lCLE1BQU00QyxVQUFVQyxJQUFJOUQsS0FBS3VCLFFBQVFoQixRQUFRQyxNQUM5Q1IsS0FBS2lCLE1BQU04QyxpQkFBaUIsU0FBVSxTQUFBQyxHQUM5QkosRUFBS0sseUJBQ0RwRCxHQUFZQSxFQUFTUSxjQUFnQjZDLFNBQ3JDckQsRUFBU21ELEdBQ1JBLEVBQUVHLE9BQU9DLHVEQVFQLElBQUFDLEVBQUFyRSxLQUdmLEdBRkFBLEtBQUtzRSxjQUFnQnRFLEtBQUtpQixNQUFNdUMsaUJBQWlCeEQsS0FBS3VCLFFBQVFwQixvQkFFekRILEtBQUtzRSxlQUFrQnRFLEtBQUtzRSxjQUFjekUsT0FPM0MwRSxNQUFNQyxLQUFLeEUsS0FBS3NFLGVBQWU5QixRQUFRLFNBQUFpQyxHQUNuQ0EsRUFBSVosVUFBVUMsSUFBSU8sRUFBSzlDLFFBQVFoQixRQUFRRSxhQUN2Q2dFLEVBQUlWLGlCQUFpQixRQUFTLFNBQUFDLEdBQzFCQSxFQUFFVSxpQkFDRkwsRUFBS3hDLG9CQVhzQyxDQUNuRCxJQUFNOEMsRUFBV3hELFNBQVMrQixjQUFjLFVBQ3hDeUIsRUFBU3hCLGFBQWEsWUFBYSxJQUNuQ3dCLEVBQVN0QixVQUFZLFFBQ3JCckQsS0FBS2lCLE1BQU0yRCxhQUFhRCxFQUFVM0UsS0FBS2lCLE1BQU00RCxZQUM3QzdFLEtBQUswRCwwREFlQyxJQUFBb0IsRUFBQTlFLEtBQ04rRSxFQUFRUixNQUFNQyxLQUFLeEUsS0FBS2lCLE1BQU11QyxpQkFBaUJ4RCxLQUFLdUIsUUFBUXJCLGdCQUVoRSxJQUFLNkUsRUFBTWxGLE9BQ1AsTUFBTSxJQUFJeUIsTUFBSixxRkFBQVksT0FBK0ZsQyxLQUFLdUIsUUFBUXJCLGNBQTVHLGlCQUVWNkUsRUFBTUMsT0FBTyxTQUFDQyxFQUFLQyxFQUFNeEQsR0FDckIsSUFBTWYsRUFBT3VFLEVBQUtDLFFBQVF4RSxLQU8xQixHQU5BdUUsRUFBS3JCLFVBQVVDLElBQUlnQixFQUFLdkQsUUFBUWhCLFFBQVFJLE1BQ3BDZSxJQUFVb0QsRUFBS3ZELFFBQVFqQixvQkFDdkI0RSxFQUFLckIsVUFBVUMsSUFBSWdCLEVBQUt2RCxRQUFRaEIsUUFBUUssYUFDeENrRSxFQUFLbkQsY0FBZ0JELEdBR3JCQSxFQUFRcUQsRUFBTWxGLE9BQVMsSUFBTXFGLEVBQUs5RCxjQUFjMEQsRUFBS3ZELFFBQVFuQixvQkFDN0QsTUFBTSxJQUFJa0IsTUFBSixxQ0FBQVksT0FBK0N2QixFQUEvQywyQ0FBQXVCLE9BQTZGNEMsRUFBS3ZELFFBQVFuQixtQkFBMUcsK0JBRVYsR0FBSXNCLEVBQVFxRCxFQUFNbEYsT0FBUyxHQUFLcUYsRUFBSzlELGNBQWMwRCxFQUFLdkQsUUFBUW5CLG9CQUFxQixDQUNqRixJQUFNNkMsRUFBY2lDLEVBQUs5RCxjQUFjMEQsRUFBS3ZELFFBQVFuQixvQkFFcEQ2QyxFQUFZWSxVQUFVQyxJQUFJZ0IsRUFBS3ZELFFBQVFoQixRQUFRRyxhQUMvQ3VDLEVBQVljLGlCQUFpQixRQUFTLFNBQUFDLEdBQ2xDQSxFQUFFVSxpQkFDRUksRUFBS2Isd0JBQ0xhLEVBQUtoRCxjQVVqQixPQU5BbUQsRUFBSUcsS0FBSyxDQUNMMUMsR0FBSXdDLEVBQ0puRCxNQUFPcEIsRUFDUDBFLFFBQVEsRUFDUkMsT0FBUSxLQUVMTCxHQUNSakYsS0FBSzRCLFFBRVI1QixLQUFLMkIsY0FBZ0IzQixLQUFLdUIsUUFBUWpCLGtCQUNsQ04sS0FBS2lDLG9EQUdLRixHQUNWLElBQU1PLEVBQVduQixTQUFTK0IsY0FBYyxXQUV4QyxPQURBWixFQUFTYSxhQUFhbkQsS0FBS3VCLFFBQVFyQixjQUFja0QsUUFBUSxVQUFXLElBQUtyQixHQUNsRU8sd0NBTUcsSUFBQWlELEVBQUF2RixLQUNWQSxLQUFLNEIsT0FBT1ksUUFBUSxTQUFDN0IsRUFBTWxELEdBQ3ZCa0QsRUFBSzBFLE9BQVNFLEVBQUs1RCxnQkFBa0JsRSxFQUNqQ2tELEVBQUswRSxPQUNMMUUsRUFBSytCLEdBQUdtQixVQUFVQyxJQUFJeUIsRUFBS2hFLFFBQVFoQixRQUFRSyxhQUUzQ0QsRUFBSytCLEdBQUdtQixVQUFVMkIsT0FBT0QsRUFBS2hFLFFBQVFoQixRQUFRSyxlQUd0RFosS0FBS3lGLHdEQU1PLElBQUFDLEVBQUExRixLQUNQQSxLQUFLc0UsZUFBa0J0RSxLQUFLc0UsY0FBY3pFLE9BRzNDMEUsTUFBTUMsS0FBS3hFLEtBQUtzRSxlQUFlOUIsUUFBUSxTQUFBaUMsR0FBRyxPQUFJQSxFQUFJa0IsTUFBTUMsUUFBaUMsSUFBdkJGLEVBQUsvRCxjQUFzQixPQUFTLEtBRnRHM0IsS0FBSzBELHVEQVNULElBQU1tQyxFQUFVN0YsS0FBSzhGLGlCQUNyQjlGLEtBQUsyQixjQUFnQjNCLEtBQUsyQixjQUFnQixFQUFJLEVBQUksRUFBSTNCLEtBQUsyQixjQUFnQixFQUMzRTNCLEtBQUt1QixRQUFRVCxhQUFhZCxLQUFLOEYsaUJBQWtCRCxHQUFVLEVBQUc3RixLQUFLaUIsT0FDbkVqQixLQUFLaUMsa0RBT0wsSUFBTTRELEVBQVU3RixLQUFLOEYsaUJBQ3JCOUYsS0FBSzJCLGNBQWdCM0IsS0FBSzJCLGNBQWdCM0IsS0FBSzRCLE9BQU8vQixPQUFTLEVBQ3pERyxLQUFLMkIsY0FBZ0IsRUFDckIzQixLQUFLNEIsT0FBTy9CLE9BQ2xCRyxLQUFLdUIsUUFBUVQsYUFBYWQsS0FBSzhGLGlCQUFrQkQsRUFBUyxFQUFHN0YsS0FBS2lCLE9BQ2xFakIsS0FBS2lDLDZEQU9MLElBQU04RCxFQUFjL0YsS0FBSzRCLE9BQU81QixLQUFLMkIsZUFDL0JVLEVBQVNyQyxLQUFLZ0csY0FBY0QsRUFBWXJELElBQzlDLEdBQUkxQyxLQUFLdUIsUUFBUVAsa0JBQW9CaEIsS0FBS3VCLFFBQVFQLGlCQUFpQkssY0FBZ0I2QyxTQUUvRSxPQURBbEUsS0FBS2lCLE1BQU1rQyxhQUFhLGFBQWMsSUFDL0JuRCxLQUFLdUIsUUFBUVAsaUJBQWlCK0UsRUFBYTFELEVBQVFyQyxLQUFLaUIsT0FFbkVqQixLQUFLaUIsTUFBTWdGLGdCQUFnQixjQUMzQkYsRUFBWVQsT0FBUyxHQUNyQixJQUFJWSxHQUFVLEVBY2QsT0FiQTNCLE1BQU1DLEtBQUtuQyxHQUNOOEQsVUFDQTNELFFBQVEsU0FBQUUsR0FDQUEsRUFBRzBELGtCQUNKRixHQUFVLEVBQ0xILEVBQVlULE9BQU81QyxFQUFHMUUsUUFDdkIrSCxFQUFZVCxPQUFPNUMsRUFBRzFFLE1BQVEsSUFFbEMrSCxFQUFZVCxPQUFPNUMsRUFBRzFFLE1BQU1vSCxLQUFLMUMsRUFBRzJELG1CQUNwQzNELEVBQUc0RCxvQkFHZnRHLEtBQUt1QixRQUFRUixhQUFhZ0YsRUFBYTFELEVBQVFyQyxLQUFLaUIsT0FDN0NpRix3Q0FHR3hELEdBQ1YsT0FBT0EsRUFBR2MsaUJBQUgsZUFBQXRCLE9BQ0RsQyxLQUFLdUIsUUFBUXJCLGNBRFosNERBQUFnQyxPQUVEbEMsS0FBS3VCLFFBQVFyQixjQUZaLHdDQUFBZ0MsT0FHRGxDLEtBQUt1QixRQUFRckIsY0FIWixnRkFRQUosSUFBWHlHLFNBQ0NBLE9BQU9qSCxlQUFlLGFBQWVpSCxPQUFPOUcsUUFBVUEsR0FDbkR5QixnQkFBZ0I3QixVQUFVbUgsVUFDMUJ0RixnQkFBZ0I3QixVQUFVbUgsUUFBVSxTQUFVN0csR0FDMUMsT0FBTyxJQUFJRixFQUFRTyxLQUFNTCxNQUlqQ25DLEVBQU9ELFFBQVVrQyIsImZpbGUiOiJ6YW5nZGFyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImNsYXNzIFphbmdkYXIge1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge0hUTUxGb3JtRWxlbWVudH1cbiAgICAgKi9cbiAgICAkZm9ybSA9IG51bGxcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHR5cGUge05vZGVMaXN0T2Z8bnVsbH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF8kcHJldkJ1dHRvbnMgPSBudWxsXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEB0eXBlIHtBcnJheX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9zdGVwcyA9IFtdXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqIEB0eXBlIHtOdW1iZXJ8bnVsbH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9jdXJyZW50SW5kZXggPSBudWxsXG5cblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtPYmplY3R9XG4gICAgICogQHR5cGUge3tzdGVwX3NlbGVjdG9yOiBzdHJpbmcsIHByZXZfc3RlcF9zZWxlY3Rvcjogc3RyaW5nLCBvblN0ZXBDaGFuZ2UoT2JqZWN0LCBPYmplY3QpOiB2b2lkLCBhY3RpdmVfc3RlcF9pbmRleDogbnVtYmVyLCBvblN1Ym1pdChFdmVudCk6IGJvb2xlYW4sIGNsYXNzZXM6IHtwcmV2X2J1dHRvbjogc3RyaW5nLCBuZXh0X2J1dHRvbjogc3RyaW5nLCBmb3JtOiBzdHJpbmcsIHN0ZXA6IHN0cmluZywgc3RlcF9hY3RpdmU6IHN0cmluZ30sIG5leHRfc3RlcF9zZWxlY3Rvcjogc3RyaW5nLCBjdXN0b21WYWxpZGF0aW9uOiAoZnVuY3Rpb24oT2JqZWN0LCBOb2RlTGlzdCk6IGJvb2xlYW4pLCBvblZhbGlkYXRpb24oT2JqZWN0LCBOb2RlTGlzdCk6IHZvaWR9fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3BhcmFtcyA9IHtcbiAgICAgICAgc3RlcF9zZWxlY3RvcjogJ1tkYXRhLXN0ZXBdJyxcbiAgICAgICAgcHJldl9zdGVwX3NlbGVjdG9yOiAnW2RhdGEtcHJldl0nLFxuICAgICAgICBuZXh0X3N0ZXBfc2VsZWN0b3I6ICdbZGF0YS1uZXh0XScsXG4gICAgICAgIHN1Ym1pdF9zZWxlY3RvcjogJ1t0eXBlPVwic3VibWl0XCJdJyxcbiAgICAgICAgYWN0aXZlX3N0ZXBfaW5kZXg6IDAsXG4gICAgICAgIGNsYXNzZXM6IHtcbiAgICAgICAgICAgIGZvcm06ICd6YW5kZ2FyX193aXphcmQnLFxuICAgICAgICAgICAgcHJldl9idXR0b246ICd6YW5kZ2FyX19wcmV2JyxcbiAgICAgICAgICAgIG5leHRfYnV0dG9uOiAnemFuZGdhcl9fbmV4dCcsXG4gICAgICAgICAgICBzdGVwOiAnemFuZGdhcl9fc3RlcCcsXG4gICAgICAgICAgICBzdGVwX2FjdGl2ZTogJ3phbmRnYXJfX3N0ZXBfX2FjdGl2ZScsXG4gICAgICAgIH0sXG4gICAgICAgIG9uU3VibWl0OiBudWxsLFxuICAgICAgICBvblN0ZXBDaGFuZ2U6IG51bGwsXG4gICAgICAgIG9uVmFsaWRhdGlvbjogbnVsbCxcbiAgICAgICAgY3VzdG9tVmFsaWRhdGlvbjogbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7SFRNTEZvcm1FbGVtZW50fFN0cmluZ30gZWxlbWVudFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZWxlbWVudCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuJGZvcm0gPSBlbGVtZW50IGluc3RhbmNlb2YgSFRNTEZvcm1FbGVtZW50XG4gICAgICAgICAgICA/IGVsZW1lbnRcbiAgICAgICAgICAgIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50KVxuXG4gICAgICAgIGlmICh0aGlzLiRmb3JtLmNvbnN0cnVjdG9yICE9PSBIVE1MRm9ybUVsZW1lbnQpXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFtFcnJdIFphbmdkYXIuY29uc3RydWN0b3IgLSB0aGUgY29udGFpbmVyIG11c3QgYmUgYSB2YWxpZCBIVE1MIGZvcm0gZWxlbWVudGApXG5cbiAgICAgICAgdGhpcy5fcGFyYW1zID0ge1xuICAgICAgICAgICAgLi4udGhpcy5fcGFyYW1zLFxuICAgICAgICAgICAgLi4ub3B0aW9uc1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faW5pdCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHN0ZXAgYnkgaGlzIGluZGV4XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXhcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9XG4gICAgICovXG4gICAgZ2V0KGluZGV4ID0gdGhpcy5fY3VycmVudEluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGVwc1tpbmRleF0gfHwgbnVsbFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldmVhbCBwcmV2aW91cyBzdGVwXG4gICAgICovXG4gICAgcHJldigpIHtcbiAgICAgICAgdGhpcy5fcHJldlN0ZXAoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldmVhbCBuZXh0IHN0ZXBcbiAgICAgKi9cbiAgICBuZXh0KCkge1xuICAgICAgICB0aGlzLl9uZXh0U3RlcCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR28gdG8gYSBzdGVwIGJ5IGxhYmVsIChkYXRhLXN0ZXAgYXR0cmlidXRlIHZhbHVlKVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGxhYmVsXG4gICAgICovXG4gICAgcmV2ZWFsU3RlcChsYWJlbCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX3N0ZXBzLmZpbmRJbmRleChzdGVwID0+IHN0ZXAubGFiZWwgPT09IGxhYmVsKVxuICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgICAgICAgdGhpcy5fcmV2ZWFsU3RlcCgpXG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbRXJyXSBaYW5nZGFyLnJldmVhbFN0ZXAgLSBzdGVwIFwiJHtsYWJlbH1cIiBub3QgZm91bmRgKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIHdpemFyZCBmcm9tIGFuIGV4aXN0aW5nIGZvcm0gd2l0aCBhIHRlbXBsYXRlIHdoaWNoIGlzIGRlc2NyaWJlcyBpdFxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHRlbXBsYXRlIHRoZSB3aXphcmQgdGVtcGxhdGVcbiAgICAgKi9cbiAgICBjcmVhdGVGcm9tVGVtcGxhdGUodGVtcGxhdGUpIHtcbiAgICAgICAgbGV0IGkgPSAwXG4gICAgICAgIGZvciAobGV0IGxhYmVsIGluIHRlbXBsYXRlKSB7XG4gICAgICAgICAgICArK2lcbiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZS5oYXNPd25Qcm9wZXJ0eShsYWJlbCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSB0ZW1wbGF0ZVtsYWJlbF1cbiAgICAgICAgICAgICAgICBjb25zdCAkc2VjdGlvbiA9IHRoaXMuX2J1aWxkU2VjdGlvbihsYWJlbClcbiAgICAgICAgICAgICAgICBmaWVsZHMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsID0gdGhpcy4kZm9ybS5xdWVyeVNlbGVjdG9yKGZpZWxkKVxuICAgICAgICAgICAgICAgICAgICBpZiAoZWwgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0VsbSA9IGVsLmNsb25lTm9kZSh0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgJHNlY3Rpb24uYXBwZW5kQ2hpbGQobmV3RWxtKVxuICAgICAgICAgICAgICAgICAgICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgaWYgKGkgPCBPYmplY3Qua2V5cyh0ZW1wbGF0ZSkubGVuZ3RoICYmICRzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IodGhpcy5fcGFyYW1zLm5leHRfc3RlcF9zZWxlY3RvcikgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJG5leHRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgICAgICAgICAgICAgICAgICAkbmV4dEJ1dHRvbi5zZXRBdHRyaWJ1dGUodGhpcy5fcGFyYW1zLm5leHRfc3RlcF9zZWxlY3Rvci5yZXBsYWNlKC9cXFt8XFxdL2lnLCAnJyksICcnKVxuICAgICAgICAgICAgICAgICAgICAkbmV4dEJ1dHRvbi5pbm5lclRleHQgPSAnTmV4dCdcbiAgICAgICAgICAgICAgICAgICAgJHNlY3Rpb24uYXBwZW5kQ2hpbGQoJG5leHRCdXR0b24pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChpID09PSBPYmplY3Qua2V5cyh0ZW1wbGF0ZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0ICRzdWJtaXRCdXR0b24gPSB0aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fcGFyYW1zLnN1Ym1pdF9zZWxlY3RvcilcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzdWJtaXRCdXR0b24gIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0J0biA9ICRzdWJtaXRCdXR0b24uY2xvbmVOb2RlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2VjdGlvbi5hcHBlbmRDaGlsZChuZXdCdG4pXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3VibWl0QnV0dG9uLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoJHN1Ym1pdEJ1dHRvbilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLiRmb3JtLmFwcGVuZENoaWxkKCRzZWN0aW9uKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2luaXQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgY3VycmVudCBzdGVwXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IHRoZSBjdXJyZW50IHN0ZXAgaWYgZXhpc3RzLCBudWxsIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGdldEN1cnJlbnRTdGVwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXQoKVxuICAgIH1cblxuICAgIF9pbml0KCkge1xuICAgICAgICBpZiAodGhpcy4kZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkRm9ybSgpXG4gICAgICAgICAgICB0aGlzLl9idWlsZFByZXZCdXR0b24oKVxuICAgICAgICAgICAgdGhpcy5fYnVpbGRTdGVwcygpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYnVpbGRGb3JtKCkge1xuICAgICAgICBjb25zdCBvblN1Ym1pdCA9IHRoaXMuX3BhcmFtcy5vblN1Ym1pdFxuICAgICAgICB0aGlzLiRmb3JtLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuZm9ybSlcbiAgICAgICAgdGhpcy4kZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLl92YWxpZGF0ZUN1cnJlbnRTdGVwKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAob25TdWJtaXQgJiYgb25TdWJtaXQuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKVxuICAgICAgICAgICAgICAgICAgICBvblN1Ym1pdChlKVxuICAgICAgICAgICAgICAgIGVsc2UgZS50YXJnZXQuc3VibWl0KClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9idWlsZFByZXZCdXR0b24oKSB7XG4gICAgICAgIHRoaXMuXyRwcmV2QnV0dG9ucyA9IHRoaXMuJGZvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9wYXJhbXMucHJldl9zdGVwX3NlbGVjdG9yKVxuXG4gICAgICAgIGlmICghdGhpcy5fJHByZXZCdXR0b25zIHx8ICF0aGlzLl8kcHJldkJ1dHRvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCAkcHJldkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICAgICAgICAkcHJldkJ0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJldicsICcnKVxuICAgICAgICAgICAgJHByZXZCdG4uaW5uZXJUZXh0ID0gJ1ByZXYuJ1xuICAgICAgICAgICAgdGhpcy4kZm9ybS5pbnNlcnRCZWZvcmUoJHByZXZCdG4sIHRoaXMuJGZvcm0uZmlyc3RDaGlsZClcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkUHJldkJ1dHRvbigpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBBcnJheS5mcm9tKHRoaXMuXyRwcmV2QnV0dG9ucykuZm9yRWFjaChidG4gPT4ge1xuICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKHRoaXMuX3BhcmFtcy5jbGFzc2VzLnByZXZfYnV0dG9uKVxuICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJldlN0ZXAoKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYnVpbGRTdGVwcygpIHtcbiAgICAgICAgbGV0IHN0ZXBzID0gQXJyYXkuZnJvbSh0aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3IpKVxuXG4gICAgICAgIGlmICghc3RlcHMubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbRXJyXSBaYW5nZGFyLl9idWlsZFN0ZXBzIC0geW91IG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgc3RlcCAoYSBIVE1MIGVsZW1lbnQgd2l0aCBcIiR7dGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3J9XCIgYXR0cmlidXRlKWApXG5cbiAgICAgICAgc3RlcHMucmVkdWNlKChhY2MsIGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGVwID0gaXRlbS5kYXRhc2V0LnN0ZXBcbiAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCh0aGlzLl9wYXJhbXMuY2xhc3Nlcy5zdGVwKVxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSB0aGlzLl9wYXJhbXMuYWN0aXZlX3N0ZXBfaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuc3RlcF9hY3RpdmUpXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gaW5kZXhcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGluZGV4IDwgc3RlcHMubGVuZ3RoIC0gMSAmJiAhaXRlbS5xdWVyeVNlbGVjdG9yKHRoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3IpKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgW0Vycl0gWmFuZ2Rhci5fYnVpbGRTdGVwcyAtIHN0ZXAgXCIke3N0ZXB9XCIgLSB5b3UgbXVzdCBoYXZlIGEgbmV4dCBidXR0b24gKHdpdGggXCIke3RoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3J9XCIgYXR0cmlidXRlXCIpIG9uIHRoaXMgc3RlcGApXG5cbiAgICAgICAgICAgIGlmIChpbmRleCA8IHN0ZXBzLmxlbmd0aCAtIDEgJiYgaXRlbS5xdWVyeVNlbGVjdG9yKHRoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3IpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJG5leHRCdXR0b24gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fcGFyYW1zLm5leHRfc3RlcF9zZWxlY3RvcilcblxuICAgICAgICAgICAgICAgICRuZXh0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMubmV4dF9idXR0b24pXG4gICAgICAgICAgICAgICAgJG5leHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl92YWxpZGF0ZUN1cnJlbnRTdGVwKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXh0U3RlcCgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYWNjLnB1c2goe1xuICAgICAgICAgICAgICAgIGVsOiBpdGVtLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBzdGVwLFxuICAgICAgICAgICAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiB7fVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBhY2NcbiAgICAgICAgfSwgdGhpcy5fc3RlcHMpXG5cbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fcGFyYW1zLmFjdGl2ZV9zdGVwX2luZGV4XG4gICAgICAgIHRoaXMuX3JldmVhbFN0ZXAoKVxuICAgIH1cblxuICAgIF9idWlsZFNlY3Rpb24obGFiZWwpIHtcbiAgICAgICAgY29uc3QgJHNlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWN0aW9uJylcbiAgICAgICAgJHNlY3Rpb24uc2V0QXR0cmlidXRlKHRoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yLnJlcGxhY2UoL1xcW3xcXF0vaWcsICcnKSwgbGFiZWwpXG4gICAgICAgIHJldHVybiAkc2VjdGlvblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JldmVhbFN0ZXAoKSB7XG4gICAgICAgIHRoaXMuX3N0ZXBzLmZvckVhY2goKHN0ZXAsIGkpID0+IHtcbiAgICAgICAgICAgIHN0ZXAuYWN0aXZlID0gdGhpcy5fY3VycmVudEluZGV4ID09PSBpXG4gICAgICAgICAgICBpZiAoc3RlcC5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBzdGVwLmVsLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuc3RlcF9hY3RpdmUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0ZXAuZWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9wYXJhbXMuY2xhc3Nlcy5zdGVwX2FjdGl2ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5faGlkZVByZXZCdG5zKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9oaWRlUHJldkJ0bnMoKSB7XG4gICAgICAgIGlmICghdGhpcy5fJHByZXZCdXR0b25zIHx8ICF0aGlzLl8kcHJldkJ1dHRvbnMubGVuZ3RoKVxuICAgICAgICAgICAgdGhpcy5fYnVpbGRQcmV2QnV0dG9uKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQXJyYXkuZnJvbSh0aGlzLl8kcHJldkJ1dHRvbnMpLmZvckVhY2goYnRuID0+IGJ0bi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5fY3VycmVudEluZGV4ID09PSAwID8gJ25vbmUnIDogJycpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcHJldlN0ZXAoKSB7XG4gICAgICAgIGNvbnN0IG9sZFN0ZXAgPSB0aGlzLmdldEN1cnJlbnRTdGVwKClcbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fY3VycmVudEluZGV4IC0gMSA8IDAgPyAwIDogdGhpcy5fY3VycmVudEluZGV4IC0gMVxuICAgICAgICB0aGlzLl9wYXJhbXMub25TdGVwQ2hhbmdlKHRoaXMuZ2V0Q3VycmVudFN0ZXAoKSwgb2xkU3RlcCwgLTEsIHRoaXMuJGZvcm0pXG4gICAgICAgIHRoaXMuX3JldmVhbFN0ZXAoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX25leHRTdGVwKCkge1xuICAgICAgICBjb25zdCBvbGRTdGVwID0gdGhpcy5nZXRDdXJyZW50U3RlcCgpXG4gICAgICAgIHRoaXMuX2N1cnJlbnRJbmRleCA9IHRoaXMuX2N1cnJlbnRJbmRleCA8IHRoaXMuX3N0ZXBzLmxlbmd0aCAtIDFcbiAgICAgICAgICAgID8gdGhpcy5fY3VycmVudEluZGV4ICsgMVxuICAgICAgICAgICAgOiB0aGlzLl9zdGVwcy5sZW5ndGhcbiAgICAgICAgdGhpcy5fcGFyYW1zLm9uU3RlcENoYW5nZSh0aGlzLmdldEN1cnJlbnRTdGVwKCksIG9sZFN0ZXAsIDEsIHRoaXMuJGZvcm0pXG4gICAgICAgIHRoaXMuX3JldmVhbFN0ZXAoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3ZhbGlkYXRlQ3VycmVudFN0ZXAoKSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRTdGVwID0gdGhpcy5fc3RlcHNbdGhpcy5fY3VycmVudEluZGV4XVxuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLl9mb3JtRWxlbWVudHMoY3VycmVudFN0ZXAuZWwpXG4gICAgICAgIGlmICh0aGlzLl9wYXJhbXMuY3VzdG9tVmFsaWRhdGlvbiAmJiB0aGlzLl9wYXJhbXMuY3VzdG9tVmFsaWRhdGlvbi5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuJGZvcm0uc2V0QXR0cmlidXRlKCdub3ZhbGlkYXRlJywgJycpXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyYW1zLmN1c3RvbVZhbGlkYXRpb24oY3VycmVudFN0ZXAsIGZpZWxkcywgdGhpcy4kZm9ybSlcbiAgICAgICAgfVxuICAgICAgICB0aGlzLiRmb3JtLnJlbW92ZUF0dHJpYnV0ZSgnbm92YWxpZGF0ZScpXG4gICAgICAgIGN1cnJlbnRTdGVwLmVycm9ycyA9IHt9XG4gICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZVxuICAgICAgICBBcnJheS5mcm9tKGZpZWxkcylcbiAgICAgICAgICAgIC5yZXZlcnNlKClcbiAgICAgICAgICAgIC5mb3JFYWNoKGVsID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWVsLmNoZWNrVmFsaWRpdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50U3RlcC5lcnJvcnNbZWwubmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGVwLmVycm9yc1tlbC5uYW1lXSA9IFtdXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0ZXAuZXJyb3JzW2VsLm5hbWVdLnB1c2goZWwudmFsaWRhdGlvbk1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgICAgIGVsLnJlcG9ydFZhbGlkaXR5KClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB0aGlzLl9wYXJhbXMub25WYWxpZGF0aW9uKGN1cnJlbnRTdGVwLCBmaWVsZHMsIHRoaXMuJGZvcm0pXG4gICAgICAgIHJldHVybiBpc1ZhbGlkXG4gICAgfVxuXG4gICAgX2Zvcm1FbGVtZW50cyhlbCkge1xuICAgICAgICByZXR1cm4gZWwucXVlcnlTZWxlY3RvckFsbChgXFxcbiAgICAgICAgICAgICR7dGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3J9IGlucHV0Om5vdChbdHlwZT1cImhpZGRlblwiXSk6bm90KFtkaXNhYmxlZF0pLFxcXG4gICAgICAgICAgICAke3RoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yfSBzZWxlY3Q6bm90KFtkaXNhYmxlZF0pLFxcXG4gICAgICAgICAgICAke3RoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yfSB0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSlcXFxuICAgICAgICBgKVxuICAgIH1cbn1cblxuaWYgKHdpbmRvdyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgIXdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnWmFuZ2RhcicpICYmICh3aW5kb3cuWmFuZ2RhciA9IFphbmdkYXIpXG4gICAgaWYoIUhUTUxGb3JtRWxlbWVudC5wcm90b3R5cGUuemFuZ2Rhcikge1xuICAgICAgICBIVE1MRm9ybUVsZW1lbnQucHJvdG90eXBlLnphbmdkYXIgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBaYW5nZGFyKHRoaXMsIG9wdGlvbnMpXG4gICAgICAgIH1cbiAgICB9XG59IGVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gWmFuZ2RhclxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==