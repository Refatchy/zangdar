!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"$form",null),n(this,"_$prevButtons",null),n(this,"_steps",[]),n(this,"_currentIndex",null),n(this,"_params",{step_selector:"[data-step]",prev_step_selector:"[data-prev]",next_step_selector:"[data-next]",submit_selector:'[type="submit"]',active_step_index:0,classes:{form:"zandgar__wizard",prev_button:"zandgar__prev",next_button:"zandgar__next",step:"zandgar__step",step_active:"zandgar__step__active"},onSubmit:function(e){return e.preventDefault(),console.log(e),!1},onValidation:function(e,t,r){console.log("On step validation",e,t)},onStepChange:function(e,t,r){console.log("On step change",e,t)},customValidation:null}),this.$form=t instanceof HTMLFormElement?t:document.querySelector(t),this.$form.constructor!==HTMLFormElement)throw new Error("[Err] Zangdar.constructor - the container must be a valid HTML form element");this._params=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},s=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),s.forEach(function(t){n(e,t,r[t])})}return e}({},this._params,r),this._init()}var t,s,a;return t=e,(s=[{key:"goTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._currentIndex;return this._steps[e]||null}},{key:"goToStep",value:function(e){throw this._steps.findIndex(function(t){return t.label===e})>=0&&this._revealStep(),new Error('[Err] Zangdar.goToStep - step "'.concat(e,'" not found'))}},{key:"createFromTemplate",value:function(e){var t=this,r=0;for(var n in e)++r,e.hasOwnProperty(n)&&function(){var s=e[n],a=t._buildSection(n);if(s.forEach(function(e){var r=t.$form.querySelector(e);if(null!==r){var n=r.cloneNode(!0);a.appendChild(n),r.parentNode.removeChild(r)}}),r<Object.keys(e).length&&null===a.querySelector(t._params.next_step_selector)){var o=document.createElement("button");o.setAttribute(t._params.next_step_selector.replace(/\[|\]/gi,""),""),o.innerText="Next",a.appendChild(o)}if(r===Object.keys(e).length){var i=t.$form.querySelector(t._params.submit_selector);if(null!==i){var u=i.cloneNode(!0);a.appendChild(u),i.parentNode.removeChild(i)}}t.$form.appendChild(a)}();this._init()}},{key:"getCurrentStep",value:function(){return this.goTo()}},{key:"_init",value:function(){this.$form.querySelectorAll(this._params.step_selector).length&&(this._buildForm(),this._buildPrevButton(),this._buildSteps())}},{key:"_buildForm",value:function(){var e=this,t=this._params.onSubmit;this.$form.classList.add(this._params.classes.form),this.$form.addEventListener("submit",function(r){e._validateCurrentStep()&&(t&&t.constructor===Function?t(r):r.target.submit())})}},{key:"_buildPrevButton",value:function(){var e=this;if(this._$prevButtons=this.$form.querySelectorAll(this._params.prev_step_selector),this._$prevButtons&&this._$prevButtons.length)Array.from(this._$prevButtons).forEach(function(t){t.classList.add(e._params.classes.prev_button),t.addEventListener("click",function(t){t.preventDefault(),e._prevStep()})});else{var t=document.createElement("button");t.setAttribute("data-prev",""),t.innerText="Prev.",this.$form.insertBefore(t,this.$form.firstChild),this._buildPrevButton()}}},{key:"_buildSteps",value:function(){var e=this,t=Array.from(this.$form.querySelectorAll(this._params.step_selector));if(!t.length)throw new Error('[Err] Zangdar._buildSteps - you must have at least one step (a HTML element with "'.concat(this._params.step_selector,'" attribute)'));t.reduce(function(r,n,s){var a=n.dataset.step;if(n.classList.add(e._params.classes.step),s===e._params.active_step_index&&(n.classList.add(e._params.classes.step_active),e._currentIndex=s),s<t.length-1&&!n.querySelector(e._params.next_step_selector))throw new Error('[Err] Zangdar._buildSteps - step "'.concat(a,'" - you must have a next button (with "').concat(e._params.next_step_selector,'" attribute") on this step'));if(s<t.length-1&&n.querySelector(e._params.next_step_selector)){var o=n.querySelector(e._params.next_step_selector);o.classList.add(e._params.classes.next_button),o.addEventListener("click",function(t){t.preventDefault(),e._validateCurrentStep()&&e._nextStep()})}return r.push({el:n,label:a,active:!1,errors:{}}),r},this._steps),this._currentIndex=this._params.active_step_index,this._revealStep()}},{key:"_buildSection",value:function(e){var t=document.createElement("section");return t.setAttribute(this._params.step_selector.replace(/\[|\]/gi,""),e),t}},{key:"_revealStep",value:function(){var e=this;this._steps.forEach(function(t,r){t.active=e._currentIndex===r,t.active?t.el.classList.add(e._params.classes.step_active):t.el.classList.remove(e._params.classes.step_active)}),this._hidePrevBtns()}},{key:"_hidePrevBtns",value:function(){var e=this;this._$prevButtons&&this._$prevButtons.length?Array.from(this._$prevButtons).forEach(function(t){return t.style.display=0===e._currentIndex?"none":""}):this._buildPrevButton()}},{key:"_prevStep",value:function(){var e=this.getCurrentStep();this._currentIndex=this._currentIndex-1<0?0:this._currentIndex-1,this._params.onStepChange(this.getCurrentStep(),e,this.$form),this._revealStep()}},{key:"_nextStep",value:function(){var e=this.getCurrentStep();this._currentIndex=this._currentIndex<this._steps.length-1?this._currentIndex+1:this._steps.length,this._params.onStepChange(this.getCurrentStep(),e,this.$form),this._revealStep()}},{key:"_validateCurrentStep",value:function(){var e=this._steps[this._currentIndex],t=this._formElements(e.el);if(this._params.customValidation&&this._params.customValidation.constructor===Function)return this.$form.setAttribute("novalidate",""),this._params.customValidation(e,t,this.$form);this.$form.removeAttribute("novalidate"),e.errors={};var r=!0;return Array.from(t).reverse().forEach(function(t){t.checkValidity()||(r=!1,e.errors[t.name]||(e.errors[t.name]=[]),e.errors[t.name].push(t.validationMessage),t.reportValidity())}),this._params.onValidation(e,t,this.$form),r}},{key:"_formElements",value:function(e){return e.querySelectorAll("            ".concat(this._params.step_selector,' input:not([type="hidden"]):not([disabled]),            ').concat(this._params.step_selector," select:not([disabled]),            ").concat(this._params.step_selector," textarea:not([disabled])        "))}}])&&r(t.prototype,s),a&&r(t,a),e}();void 0!==window?(!window.hasOwnProperty("Zangdar")&&(window.Zangdar=s),HTMLFormElement.prototype.zangdar||(HTMLFormElement.prototype.zangdar=function(e){return new s(this,e)})):e.exports=s}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiWmFuZ2RhciIsImVsZW1lbnQiLCJvcHRpb25zIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIl9kZWZpbmVQcm9wZXJ0eSIsInN0ZXBfc2VsZWN0b3IiLCJwcmV2X3N0ZXBfc2VsZWN0b3IiLCJuZXh0X3N0ZXBfc2VsZWN0b3IiLCJzdWJtaXRfc2VsZWN0b3IiLCJhY3RpdmVfc3RlcF9pbmRleCIsImNsYXNzZXMiLCJmb3JtIiwicHJldl9idXR0b24iLCJuZXh0X2J1dHRvbiIsInN0ZXAiLCJzdGVwX2FjdGl2ZSIsIm9uU3VibWl0IiwiZSIsInByZXZlbnREZWZhdWx0IiwiY29uc29sZSIsImxvZyIsIm9uVmFsaWRhdGlvbiIsImZpZWxkcyIsIm9uU3RlcENoYW5nZSIsIm9sZFN0ZXAiLCJjdXN0b21WYWxpZGF0aW9uIiwiJGZvcm0iLCJIVE1MRm9ybUVsZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb25zdHJ1Y3RvciIsIkVycm9yIiwiX3BhcmFtcyIsIl9vYmplY3RTcHJlYWQiLCJfaW5pdCIsImluZGV4IiwiX2N1cnJlbnRJbmRleCIsIl9zdGVwcyIsImxhYmVsIiwiZmluZEluZGV4IiwiX3JldmVhbFN0ZXAiLCJjb25jYXQiLCJ0ZW1wbGF0ZSIsIl90aGlzIiwiJHNlY3Rpb24iLCJfYnVpbGRTZWN0aW9uIiwiZm9yRWFjaCIsImZpZWxkIiwiZWwiLCJuZXdFbG0iLCJjbG9uZU5vZGUiLCJhcHBlbmRDaGlsZCIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsImtleXMiLCIkbmV4dEJ1dHRvbiIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJyZXBsYWNlIiwiaW5uZXJUZXh0IiwiJHN1Ym1pdEJ1dHRvbiIsIm5ld0J0biIsImdvVG8iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2J1aWxkRm9ybSIsIl9idWlsZFByZXZCdXR0b24iLCJfYnVpbGRTdGVwcyIsIl90aGlzMiIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJfdmFsaWRhdGVDdXJyZW50U3RlcCIsIkZ1bmN0aW9uIiwidGFyZ2V0Iiwic3VibWl0IiwiX3RoaXMzIiwiXyRwcmV2QnV0dG9ucyIsIkFycmF5IiwiZnJvbSIsImJ0biIsIl9wcmV2U3RlcCIsIiRwcmV2QnRuIiwiaW5zZXJ0QmVmb3JlIiwiZmlyc3RDaGlsZCIsIl90aGlzNCIsInN0ZXBzIiwicmVkdWNlIiwiYWNjIiwiaXRlbSIsImRhdGFzZXQiLCJfbmV4dFN0ZXAiLCJwdXNoIiwiYWN0aXZlIiwiZXJyb3JzIiwiX3RoaXM1IiwicmVtb3ZlIiwiX2hpZGVQcmV2QnRucyIsIl90aGlzNiIsInN0eWxlIiwiZGlzcGxheSIsImdldEN1cnJlbnRTdGVwIiwiY3VycmVudFN0ZXAiLCJfZm9ybUVsZW1lbnRzIiwicmVtb3ZlQXR0cmlidXRlIiwiaXNWYWxpZCIsInJldmVyc2UiLCJjaGVja1ZhbGlkaXR5IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJyZXBvcnRWYWxpZGl0eSIsIndpbmRvdyIsInphbmdkYXIiXSwibWFwcGluZ3MiOiJhQUNB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QUtpQyxlQUMvQmQsRUFBU25CLEtBQUttRyxjQUFjRCxFQUFZckQsSUFDOUMsR0FBSTdDLEtBQUs2QixRQUFRUCxrQkFBb0J0QixLQUFLNkIsUUFBUVAsaUJBQWlCSyxjQUFnQjBDLFNBRS9FLE9BREFyRSxLQUFLdUIsTUFBTStCLGFBQWEsYUFBYyxJQUMvQnRELEtBQUs2QixRQUFRUCxpQkFBaUI0RSxFQUFhL0UsRUFBUW5CLEtBQUt1QixPQUVuRXZCLEtBQUt1QixNQUFNNkUsZ0JBQWdCLGNBQzNCRixFQUFZUixPQUFTLEdBQ3JCLElBQUlXLEdBQVUsRUFjZCxPQWJBM0IsTUFBTUMsS0FBS3hELEdBQ05tRixVQUNBM0QsUUFBUSxTQUFBRSxHQUNBQSxFQUFHMEQsa0JBQ0pGLEdBQVUsRUFDTEgsRUFBWVIsT0FBTzdDLEVBQUc3RSxRQUN2QmtJLEVBQVlSLE9BQU83QyxFQUFHN0UsTUFBUSxJQUVsQ2tJLEVBQVlSLE9BQU83QyxFQUFHN0UsTUFBTXdILEtBQUszQyxFQUFHMkQsbUJBQ3BDM0QsRUFBRzRELG9CQUdmekcsS0FBSzZCLFFBQVFYLGFBQWFnRixFQUFhL0UsRUFBUW5CLEtBQUt1QixPQUM3QzhFLHdDQUdHeEQsR0FDVixPQUFPQSxFQUFHZSxpQkFBSCxlQUFBdEIsT0FDRHRDLEtBQUs2QixRQUFRM0IsY0FEWiw0REFBQW9DLE9BRUR0QyxLQUFLNkIsUUFBUTNCLGNBRlosd0NBQUFvQyxPQUdEdEMsS0FBSzZCLFFBQVEzQixjQUhaLGdGQVFBSixJQUFYNEcsU0FDQ0EsT0FBT3BILGVBQWUsYUFBZW9ILE9BQU9qSCxRQUFVQSxHQUNuRCtCLGdCQUFnQm5DLFVBQVVzSCxVQUMxQm5GLGdCQUFnQm5DLFVBQVVzSCxRQUFVLFNBQVVoSCxHQUMxQyxPQUFPLElBQUlGLEVBQVFPLEtBQU1MLE1BSWpDbkMsRUFBT0QsUUFBVWtDIiwiZmlsZSI6InphbmdkYXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiY2xhc3MgWmFuZ2RhciB7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7SFRNTEZvcm1FbGVtZW50fVxuICAgICAqL1xuICAgICRmb3JtID0gbnVsbFxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAdHlwZSB7Tm9kZUxpc3RPZnxudWxsfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgXyRwcmV2QnV0dG9ucyA9IG51bGxcblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHR5cGUge0FycmF5fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3N0ZXBzID0gW11cblxuICAgIC8qKlxuICAgICAqXG4gICAgICogQHR5cGUge051bWJlcnxudWxsfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2N1cnJlbnRJbmRleCA9IG51bGxcblxuXG4gICAgLyoqXG4gICAgICogQHR5cGUge09iamVjdH1cbiAgICAgKiBAdHlwZSB7e3N0ZXBfc2VsZWN0b3I6IHN0cmluZywgcHJldl9zdGVwX3NlbGVjdG9yOiBzdHJpbmcsIG9uU3RlcENoYW5nZShPYmplY3QsIE9iamVjdCk6IHZvaWQsIGFjdGl2ZV9zdGVwX2luZGV4OiBudW1iZXIsIG9uU3VibWl0KEV2ZW50KTogYm9vbGVhbiwgY2xhc3Nlczoge3ByZXZfYnV0dG9uOiBzdHJpbmcsIG5leHRfYnV0dG9uOiBzdHJpbmcsIGZvcm06IHN0cmluZywgc3RlcDogc3RyaW5nLCBzdGVwX2FjdGl2ZTogc3RyaW5nfSwgbmV4dF9zdGVwX3NlbGVjdG9yOiBzdHJpbmcsIGN1c3RvbVZhbGlkYXRpb246IChmdW5jdGlvbihPYmplY3QsIE5vZGVMaXN0KTogYm9vbGVhbiksIG9uVmFsaWRhdGlvbihPYmplY3QsIE5vZGVMaXN0KTogdm9pZH19XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcGFyYW1zID0ge1xuICAgICAgICBzdGVwX3NlbGVjdG9yOiAnW2RhdGEtc3RlcF0nLFxuICAgICAgICBwcmV2X3N0ZXBfc2VsZWN0b3I6ICdbZGF0YS1wcmV2XScsXG4gICAgICAgIG5leHRfc3RlcF9zZWxlY3RvcjogJ1tkYXRhLW5leHRdJyxcbiAgICAgICAgc3VibWl0X3NlbGVjdG9yOiAnW3R5cGU9XCJzdWJtaXRcIl0nLFxuICAgICAgICBhY3RpdmVfc3RlcF9pbmRleDogMCxcbiAgICAgICAgY2xhc3Nlczoge1xuICAgICAgICAgICAgZm9ybTogJ3phbmRnYXJfX3dpemFyZCcsXG4gICAgICAgICAgICBwcmV2X2J1dHRvbjogJ3phbmRnYXJfX3ByZXYnLFxuICAgICAgICAgICAgbmV4dF9idXR0b246ICd6YW5kZ2FyX19uZXh0JyxcbiAgICAgICAgICAgIHN0ZXA6ICd6YW5kZ2FyX19zdGVwJyxcbiAgICAgICAgICAgIHN0ZXBfYWN0aXZlOiAnemFuZGdhcl9fc3RlcF9fYWN0aXZlJyxcbiAgICAgICAgfSxcbiAgICAgICAgb25TdWJtaXQoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH0sXG4gICAgICAgIG9uVmFsaWRhdGlvbihzdGVwLCBmaWVsZHMsIGZvcm0pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPbiBzdGVwIHZhbGlkYXRpb24nLCBzdGVwLCBmaWVsZHMpXG4gICAgICAgIH0sXG4gICAgICAgIG9uU3RlcENoYW5nZShzdGVwLCBvbGRTdGVwLCBmb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnT24gc3RlcCBjaGFuZ2UnLCBzdGVwLCBvbGRTdGVwKVxuICAgICAgICB9LFxuICAgICAgICAvKmN1c3RvbVZhbGlkYXRpb24oc3RlcCwgZmllbGRzLCBmb3JtKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnT24gY3VzdG9tIHZhbGlkYXRpb24nLCBzdGVwLCBmaWVsZHMpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9LCovXG4gICAgICAgIGN1c3RvbVZhbGlkYXRpb246IG51bGxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge0hUTUxGb3JtRWxlbWVudHxTdHJpbmd9IGVsZW1lbnRcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGVsZW1lbnQsIG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLiRmb3JtID0gZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxGb3JtRWxlbWVudFxuICAgICAgICAgICAgPyBlbGVtZW50XG4gICAgICAgICAgICA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudClcblxuICAgICAgICBpZiAodGhpcy4kZm9ybS5jb25zdHJ1Y3RvciAhPT0gSFRNTEZvcm1FbGVtZW50KVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbRXJyXSBaYW5nZGFyLmNvbnN0cnVjdG9yIC0gdGhlIGNvbnRhaW5lciBtdXN0IGJlIGEgdmFsaWQgSFRNTCBmb3JtIGVsZW1lbnRgKVxuXG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IHtcbiAgICAgICAgICAgIC4uLnRoaXMuX3BhcmFtcyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2luaXQoKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBzdGVwIGJ5IGhpcyBpbmRleFxuICAgICAqXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4XG4gICAgICogQHJldHVybnMge09iamVjdHxudWxsfVxuICAgICAqL1xuICAgIGdvVG8oaW5kZXggPSB0aGlzLl9jdXJyZW50SW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0ZXBzW2luZGV4XSB8fCBudWxsXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR28gdG8gYSBzdGVwIGJ5IGxhYmVsIChkYXRhLXN0ZXAgYXR0cmlidXRlIHZhbHVlKVxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGxhYmVsXG4gICAgICovXG4gICAgZ29Ub1N0ZXAobGFiZWwpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9zdGVwcy5maW5kSW5kZXgoc3RlcCA9PiBzdGVwLmxhYmVsID09PSBsYWJlbClcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3JldmVhbFN0ZXAoKVxuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgW0Vycl0gWmFuZ2Rhci5nb1RvU3RlcCAtIHN0ZXAgXCIke2xhYmVsfVwiIG5vdCBmb3VuZGApXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGEgd2l6YXJkIGZyb20gYW4gZXhpc3RpbmcgZm9ybSB3aXRoIGEgdGVtcGxhdGUgd2hpY2ggaXMgZGVzY3JpYmVzIGl0XG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gdGVtcGxhdGUgdGhlIHdpemFyZCB0ZW1wbGF0ZVxuICAgICAqL1xuICAgIGNyZWF0ZUZyb21UZW1wbGF0ZSh0ZW1wbGF0ZSkge1xuICAgICAgICBsZXQgaSA9IDBcbiAgICAgICAgZm9yIChsZXQgbGFiZWwgaW4gdGVtcGxhdGUpIHtcbiAgICAgICAgICAgICsraVxuICAgICAgICAgICAgaWYgKHRlbXBsYXRlLmhhc093blByb3BlcnR5KGxhYmVsKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHRlbXBsYXRlW2xhYmVsXVxuICAgICAgICAgICAgICAgIGNvbnN0ICRzZWN0aW9uID0gdGhpcy5fYnVpbGRTZWN0aW9uKGxhYmVsKVxuICAgICAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWwgPSB0aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3IoZmllbGQpXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3RWxtID0gZWwuY2xvbmVOb2RlKHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2VjdGlvbi5hcHBlbmRDaGlsZChuZXdFbG0pXG4gICAgICAgICAgICAgICAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICBpZiAoaSA8IE9iamVjdC5rZXlzKHRlbXBsYXRlKS5sZW5ndGggJiYgJHNlY3Rpb24ucXVlcnlTZWxlY3Rvcih0aGlzLl9wYXJhbXMubmV4dF9zdGVwX3NlbGVjdG9yKSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCAkbmV4dEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICAgICAgICAgICAgICAgICRuZXh0QnV0dG9uLnNldEF0dHJpYnV0ZSh0aGlzLl9wYXJhbXMubmV4dF9zdGVwX3NlbGVjdG9yLnJlcGxhY2UoL1xcW3xcXF0vaWcsICcnKSwgJycpXG4gICAgICAgICAgICAgICAgICAgICRuZXh0QnV0dG9uLmlubmVyVGV4dCA9ICdOZXh0J1xuICAgICAgICAgICAgICAgICAgICAkc2VjdGlvbi5hcHBlbmRDaGlsZCgkbmV4dEJ1dHRvbilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGkgPT09IE9iamVjdC5rZXlzKHRlbXBsYXRlKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgJHN1Ym1pdEJ1dHRvbiA9IHRoaXMuJGZvcm0ucXVlcnlTZWxlY3Rvcih0aGlzLl9wYXJhbXMuc3VibWl0X3NlbGVjdG9yKVxuICAgICAgICAgICAgICAgICAgICBpZiAoJHN1Ym1pdEJ1dHRvbiAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3QnRuID0gJHN1Ym1pdEJ1dHRvbi5jbG9uZU5vZGUodHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICRzZWN0aW9uLmFwcGVuZENoaWxkKG5ld0J0bilcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdWJtaXRCdXR0b24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCgkc3VibWl0QnV0dG9uKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuJGZvcm0uYXBwZW5kQ2hpbGQoJHNlY3Rpb24pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faW5pdCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBjdXJyZW50IHN0ZXBcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gdGhlIGN1cnJlbnQgc3RlcCBpZiBleGlzdHMsIG51bGwgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgZ2V0Q3VycmVudFN0ZXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdvVG8oKVxuICAgIH1cblxuICAgIF9pbml0KCkge1xuICAgICAgICBpZiAodGhpcy4kZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkRm9ybSgpXG4gICAgICAgICAgICB0aGlzLl9idWlsZFByZXZCdXR0b24oKVxuICAgICAgICAgICAgdGhpcy5fYnVpbGRTdGVwcygpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYnVpbGRGb3JtKCkge1xuICAgICAgICBjb25zdCBvblN1Ym1pdCA9IHRoaXMuX3BhcmFtcy5vblN1Ym1pdFxuICAgICAgICB0aGlzLiRmb3JtLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuZm9ybSlcbiAgICAgICAgdGhpcy4kZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBlID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLl92YWxpZGF0ZUN1cnJlbnRTdGVwKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAob25TdWJtaXQgJiYgb25TdWJtaXQuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKVxuICAgICAgICAgICAgICAgICAgICBvblN1Ym1pdChlKVxuICAgICAgICAgICAgICAgIGVsc2UgZS50YXJnZXQuc3VibWl0KClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9idWlsZFByZXZCdXR0b24oKSB7XG4gICAgICAgIHRoaXMuXyRwcmV2QnV0dG9ucyA9IHRoaXMuJGZvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9wYXJhbXMucHJldl9zdGVwX3NlbGVjdG9yKVxuXG4gICAgICAgIGlmICghdGhpcy5fJHByZXZCdXR0b25zIHx8ICF0aGlzLl8kcHJldkJ1dHRvbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCAkcHJldkJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICAgICAgICAkcHJldkJ0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJldicsICcnKVxuICAgICAgICAgICAgJHByZXZCdG4uaW5uZXJUZXh0ID0gJ1ByZXYuJ1xuICAgICAgICAgICAgdGhpcy4kZm9ybS5pbnNlcnRCZWZvcmUoJHByZXZCdG4sIHRoaXMuJGZvcm0uZmlyc3RDaGlsZClcbiAgICAgICAgICAgIHRoaXMuX2J1aWxkUHJldkJ1dHRvbigpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBBcnJheS5mcm9tKHRoaXMuXyRwcmV2QnV0dG9ucykuZm9yRWFjaChidG4gPT4ge1xuICAgICAgICAgICAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKHRoaXMuX3BhcmFtcy5jbGFzc2VzLnByZXZfYnV0dG9uKVxuICAgICAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJldlN0ZXAoKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfYnVpbGRTdGVwcygpIHtcbiAgICAgICAgbGV0IHN0ZXBzID0gQXJyYXkuZnJvbSh0aGlzLiRmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3IpKVxuXG4gICAgICAgIGlmICghc3RlcHMubGVuZ3RoKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBbRXJyXSBaYW5nZGFyLl9idWlsZFN0ZXBzIC0geW91IG11c3QgaGF2ZSBhdCBsZWFzdCBvbmUgc3RlcCAoYSBIVE1MIGVsZW1lbnQgd2l0aCBcIiR7dGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3J9XCIgYXR0cmlidXRlKWApXG5cbiAgICAgICAgc3RlcHMucmVkdWNlKChhY2MsIGl0ZW0sIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzdGVwID0gaXRlbS5kYXRhc2V0LnN0ZXBcbiAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCh0aGlzLl9wYXJhbXMuY2xhc3Nlcy5zdGVwKVxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSB0aGlzLl9wYXJhbXMuYWN0aXZlX3N0ZXBfaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuc3RlcF9hY3RpdmUpXG4gICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gaW5kZXhcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGluZGV4IDwgc3RlcHMubGVuZ3RoIC0gMSAmJiAhaXRlbS5xdWVyeVNlbGVjdG9yKHRoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3IpKVxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgW0Vycl0gWmFuZ2Rhci5fYnVpbGRTdGVwcyAtIHN0ZXAgXCIke3N0ZXB9XCIgLSB5b3UgbXVzdCBoYXZlIGEgbmV4dCBidXR0b24gKHdpdGggXCIke3RoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3J9XCIgYXR0cmlidXRlXCIpIG9uIHRoaXMgc3RlcGApXG5cbiAgICAgICAgICAgIGlmIChpbmRleCA8IHN0ZXBzLmxlbmd0aCAtIDEgJiYgaXRlbS5xdWVyeVNlbGVjdG9yKHRoaXMuX3BhcmFtcy5uZXh0X3N0ZXBfc2VsZWN0b3IpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgJG5leHRCdXR0b24gPSBpdGVtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fcGFyYW1zLm5leHRfc3RlcF9zZWxlY3RvcilcblxuICAgICAgICAgICAgICAgICRuZXh0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMubmV4dF9idXR0b24pXG4gICAgICAgICAgICAgICAgJG5leHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl92YWxpZGF0ZUN1cnJlbnRTdGVwKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9uZXh0U3RlcCgpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYWNjLnB1c2goe1xuICAgICAgICAgICAgICAgIGVsOiBpdGVtLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBzdGVwLFxuICAgICAgICAgICAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiB7fVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiBhY2NcbiAgICAgICAgfSwgdGhpcy5fc3RlcHMpXG5cbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fcGFyYW1zLmFjdGl2ZV9zdGVwX2luZGV4XG4gICAgICAgIHRoaXMuX3JldmVhbFN0ZXAoKVxuICAgIH1cblxuICAgIF9idWlsZFNlY3Rpb24obGFiZWwpIHtcbiAgICAgICAgY29uc3QgJHNlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWN0aW9uJylcbiAgICAgICAgJHNlY3Rpb24uc2V0QXR0cmlidXRlKHRoaXMuX3BhcmFtcy5zdGVwX3NlbGVjdG9yLnJlcGxhY2UoL1xcW3xcXF0vaWcsICcnKSwgbGFiZWwpXG4gICAgICAgIHJldHVybiAkc2VjdGlvblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JldmVhbFN0ZXAoKSB7XG4gICAgICAgIHRoaXMuX3N0ZXBzLmZvckVhY2goKHN0ZXAsIGkpID0+IHtcbiAgICAgICAgICAgIHN0ZXAuYWN0aXZlID0gdGhpcy5fY3VycmVudEluZGV4ID09PSBpXG4gICAgICAgICAgICBpZiAoc3RlcC5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBzdGVwLmVsLmNsYXNzTGlzdC5hZGQodGhpcy5fcGFyYW1zLmNsYXNzZXMuc3RlcF9hY3RpdmUpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHN0ZXAuZWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9wYXJhbXMuY2xhc3Nlcy5zdGVwX2FjdGl2ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgdGhpcy5faGlkZVByZXZCdG5zKClcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9oaWRlUHJldkJ0bnMoKSB7XG4gICAgICAgIGlmICghdGhpcy5fJHByZXZCdXR0b25zIHx8ICF0aGlzLl8kcHJldkJ1dHRvbnMubGVuZ3RoKVxuICAgICAgICAgICAgdGhpcy5fYnVpbGRQcmV2QnV0dG9uKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQXJyYXkuZnJvbSh0aGlzLl8kcHJldkJ1dHRvbnMpLmZvckVhY2goYnRuID0+IGJ0bi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5fY3VycmVudEluZGV4ID09PSAwID8gJ25vbmUnIDogJycpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcHJldlN0ZXAoKSB7XG4gICAgICAgIGNvbnN0IG9sZFN0ZXAgPSB0aGlzLmdldEN1cnJlbnRTdGVwKClcbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fY3VycmVudEluZGV4IC0gMSA8IDAgPyAwIDogdGhpcy5fY3VycmVudEluZGV4IC0gMVxuICAgICAgICB0aGlzLl9wYXJhbXMub25TdGVwQ2hhbmdlKHRoaXMuZ2V0Q3VycmVudFN0ZXAoKSwgb2xkU3RlcCwgdGhpcy4kZm9ybSlcbiAgICAgICAgdGhpcy5fcmV2ZWFsU3RlcCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbmV4dFN0ZXAoKSB7XG4gICAgICAgIGNvbnN0IG9sZFN0ZXAgPSB0aGlzLmdldEN1cnJlbnRTdGVwKClcbiAgICAgICAgdGhpcy5fY3VycmVudEluZGV4ID0gdGhpcy5fY3VycmVudEluZGV4IDwgdGhpcy5fc3RlcHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgPyB0aGlzLl9jdXJyZW50SW5kZXggKyAxXG4gICAgICAgICAgICA6IHRoaXMuX3N0ZXBzLmxlbmd0aFxuICAgICAgICB0aGlzLl9wYXJhbXMub25TdGVwQ2hhbmdlKHRoaXMuZ2V0Q3VycmVudFN0ZXAoKSwgb2xkU3RlcCwgdGhpcy4kZm9ybSlcbiAgICAgICAgdGhpcy5fcmV2ZWFsU3RlcCgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfdmFsaWRhdGVDdXJyZW50U3RlcCgpIHtcbiAgICAgICAgY29uc3QgY3VycmVudFN0ZXAgPSB0aGlzLl9zdGVwc1t0aGlzLl9jdXJyZW50SW5kZXhdXG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuX2Zvcm1FbGVtZW50cyhjdXJyZW50U3RlcC5lbClcbiAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5jdXN0b21WYWxpZGF0aW9uICYmIHRoaXMuX3BhcmFtcy5jdXN0b21WYWxpZGF0aW9uLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgICAgICAgdGhpcy4kZm9ybS5zZXRBdHRyaWJ1dGUoJ25vdmFsaWRhdGUnLCAnJylcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMuY3VzdG9tVmFsaWRhdGlvbihjdXJyZW50U3RlcCwgZmllbGRzLCB0aGlzLiRmb3JtKVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuJGZvcm0ucmVtb3ZlQXR0cmlidXRlKCdub3ZhbGlkYXRlJylcbiAgICAgICAgY3VycmVudFN0ZXAuZXJyb3JzID0ge31cbiAgICAgICAgbGV0IGlzVmFsaWQgPSB0cnVlXG4gICAgICAgIEFycmF5LmZyb20oZmllbGRzKVxuICAgICAgICAgICAgLnJldmVyc2UoKVxuICAgICAgICAgICAgLmZvckVhY2goZWwgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghZWwuY2hlY2tWYWxpZGl0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRTdGVwLmVycm9yc1tlbC5uYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0ZXAuZXJyb3JzW2VsLm5hbWVdID0gW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RlcC5lcnJvcnNbZWwubmFtZV0ucHVzaChlbC52YWxpZGF0aW9uTWVzc2FnZSlcbiAgICAgICAgICAgICAgICAgICAgZWwucmVwb3J0VmFsaWRpdHkoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIHRoaXMuX3BhcmFtcy5vblZhbGlkYXRpb24oY3VycmVudFN0ZXAsIGZpZWxkcywgdGhpcy4kZm9ybSlcbiAgICAgICAgcmV0dXJuIGlzVmFsaWRcbiAgICB9XG5cbiAgICBfZm9ybUVsZW1lbnRzKGVsKSB7XG4gICAgICAgIHJldHVybiBlbC5xdWVyeVNlbGVjdG9yQWxsKGBcXFxuICAgICAgICAgICAgJHt0aGlzLl9wYXJhbXMuc3RlcF9zZWxlY3Rvcn0gaW5wdXQ6bm90KFt0eXBlPVwiaGlkZGVuXCJdKTpub3QoW2Rpc2FibGVkXSksXFxcbiAgICAgICAgICAgICR7dGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3J9IHNlbGVjdDpub3QoW2Rpc2FibGVkXSksXFxcbiAgICAgICAgICAgICR7dGhpcy5fcGFyYW1zLnN0ZXBfc2VsZWN0b3J9IHRleHRhcmVhOm5vdChbZGlzYWJsZWRdKVxcXG4gICAgICAgIGApXG4gICAgfVxufVxuXG5pZiAod2luZG93ICE9PSB1bmRlZmluZWQpIHtcbiAgICAhd2luZG93Lmhhc093blByb3BlcnR5KCdaYW5nZGFyJykgJiYgKHdpbmRvdy5aYW5nZGFyID0gWmFuZ2RhcilcbiAgICBpZighSFRNTEZvcm1FbGVtZW50LnByb3RvdHlwZS56YW5nZGFyKSB7XG4gICAgICAgIEhUTUxGb3JtRWxlbWVudC5wcm90b3R5cGUuemFuZ2RhciA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFphbmdkYXIodGhpcywgb3B0aW9ucylcbiAgICAgICAgfVxuICAgIH1cbn0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBaYW5nZGFyXG59XG4iXSwic291cmNlUm9vdCI6IiJ9